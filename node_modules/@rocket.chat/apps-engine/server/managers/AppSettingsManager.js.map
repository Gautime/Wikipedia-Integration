{"version":3,"sources":["src/server/managers/AppSettingsManager.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,wDAAsD;AAGtD,iDAA8C;AAE9C;IACI,YAAoB,OAAmB;QAAnB,YAAO,GAAP,OAAO,CAAY;IAAI,CAAC;IAErC,cAAc,CAAC,KAAa;QAC/B,MAAM,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QAE1C,IAAI,CAAC,EAAE,EAAE;YACL,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;SACvD;QAED,OAAO,qBAAS,CAAC,kBAAkB,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,QAAQ,CAAC,CAAC;IACtE,CAAC;IAEM,aAAa,CAAC,KAAa,EAAE,SAAiB;QACjD,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QAE5C,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;YACtB,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;SACvE;QAED,OAAO,qBAAS,CAAC,kBAAkB,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;IAC7D,CAAC;IAEY,gBAAgB,CAAC,KAAa,EAAE,OAAiB;;YAC1D,MAAM,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAE1C,IAAI,CAAC,EAAE,EAAE;gBACL,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;aACvD;YAED,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE;gBAC3C,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;aACvE;YAED,OAAO,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;YAC/B,EAAE,CAAC,cAAc,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC;YAEnD,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,CAAC;YAEzE,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;YAExB,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,yBAAyB,EAAE,CAAC,mBAAmB,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YAE1F,MAAM,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC,sBAAsB,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;YAC1F,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;YACvE,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;YAEnE,EAAE,CAAC,IAAI,CAAC,oBAAS,CAAC,gBAAgB,EAAE,OAAO,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAC7E,CAAC;KAAA;CACJ;AAjDD,gDAiDC","file":"AppSettingsManager.js","sourcesContent":["import { AppMethod } from '../../definition/metadata';\nimport { ISetting } from '../../definition/settings';\nimport { AppManager } from '../AppManager';\nimport { Utilities } from '../misc/Utilities';\n\nexport class AppSettingsManager {\n    constructor(private manager: AppManager) { }\n\n    public getAppSettings(appId: string): { [key: string]: ISetting } {\n        const rl = this.manager.getOneById(appId);\n\n        if (!rl) {\n            throw new Error('No App found by the provided id.');\n        }\n\n        return Utilities.deepCloneAndFreeze(rl.getStorageItem().settings);\n    }\n\n    public getAppSetting(appId: string, settingId: string): ISetting {\n        const settings = this.getAppSettings(appId);\n\n        if (!settings[settingId]) {\n            throw new Error('No setting found for the App by the provided id.');\n        }\n\n        return Utilities.deepCloneAndFreeze(settings[settingId]);\n    }\n\n    public async updateAppSetting(appId: string, setting: ISetting): Promise<void> {\n        const rl = this.manager.getOneById(appId);\n\n        if (!rl) {\n            throw new Error('No App found by the provided id.');\n        }\n\n        if (!rl.getStorageItem().settings[setting.id]) {\n            throw new Error('No setting found for the App by the provided id.');\n        }\n\n        setting.updatedAt = new Date();\n        rl.getStorageItem().settings[setting.id] = setting;\n\n        const item = await this.manager.getStorage().update(rl.getStorageItem());\n\n        rl.setStorageItem(item);\n\n        this.manager.getBridges().getAppDetailChangesBridge().onAppSettingsChange(appId, setting);\n\n        const configModify = this.manager.getAccessorManager().getConfigurationModify(rl.getID());\n        const reader = this.manager.getAccessorManager().getReader(rl.getID());\n        const http = this.manager.getAccessorManager().getHttp(rl.getID());\n\n        rl.call(AppMethod.ONSETTINGUPDATED, setting, configModify, reader, http);\n    }\n}\n"]}